# 🦔 什錦雜貨鋪 ETF - 未來功能規劃

## 🎯 高優先度

### 1. 首頁整合投資組合歷史圖表 + 個股鑽取功能
- **描述**：將投資組合總值走勢圖移至首頁，點擊個股可進入該股歷史數據頁面
- **設計需求**：
  - 在 Dashboard 首頁上方顯示投資組合總值走勢圖（預設顯示 3 個月）
  - 持股表格的每一列可點擊，進入該股的歷史圖表頁面
  - 個股頁面顯示該股的歷史價格走勢與詳細資訊
  - 移除現有的獨立圖表頁面或改為個股專用頁面
- **技術方案**：
  - Dashboard 需改為 Client Component 以支援圖表互動
  - 使用 Next.js Dynamic Routes: `/charts/[symbol]` 顯示個股
  - 可能需要調整 Portfolio History API 支援個股查詢
- **狀態**：待開發
- **優先度**：🔥 最高

### 2. 前端快取優化
- **描述**：實作前端快取機制減少重複 API 請求
- **建議方案**：
  - 使用 SWR 或 React Query 管理資料快取
  - 設定 5 分鐘快取時間（台股/美股開盤期間）
  - 支援手動刷新（RefreshButton）清除快取
  - 背景自動重新驗證資料
- **優點**：
  - ✅ 減少 API 請求次數
  - ✅ 更快的頁面切換體驗
  - ✅ 降低伺服器負載
- **狀態**：待評估
- **優先度**：高

### 3. 載入狀態與錯誤處理優化
- **描述**：改善載入體驗與錯誤處理機制
- **改進項目**：
  - **Loading States**:
    - 個股圖表：骨架屏顯示（Skeleton）
    - Portfolio 圖表：漸進式載入動畫
    - 數據表格：行級別載入指示器
  - **Error Handling**:
    - API 失敗時顯示友善錯誤訊息
    - 自動重試機制（最多 3 次，指數退避）
    - 部分資料失敗時仍顯示可用資料
  - **Empty States**:
    - 無歷史資料時顯示提示訊息
    - 引導使用者檢查股票代碼或日期範圍
- **狀態**：待開發
- **優先度**：高

### ~~4. 投資組合總值歷史圖表~~
- **完成日期**：2025-12-30
- **完成方式**：在另一台電腦上實作完成
- **描述**：在圖表頁面實作真正的投資組合總值走勢圖
- **實作方式**：方案 A - 即時計算（無需 Database）
  - 並行抓取所有股票的歷史資料
  - 後端計算每天的總值並繪製圖表
  - 實際載入時間：357ms（並行請求）
- **已實作功能**：
  - ✅ 支援 1 個月、3 個月、6 個月、1 年時間範圍
  - ✅ 從 ETF 起始日期 2024-05-30 開始計算
  - ✅ 使用日期交集確保資料完整性（只顯示所有股票都有資料的日期）
  - ✅ 創建 `/api/portfolio-history` endpoint
  - ✅ 新增 RefreshButton 元件支援手動刷新
- **後續改進**：現已規劃移至首頁（見 #1）

### 5. 持股拖拽排序功能
- **描述**：允許使用者自訂持股表格的顯示順序
- **技術需求**：
  - 安裝 `@dnd-kit/core` 和 `@dnd-kit/sortable`
  - 使用 localStorage 儲存排序設定
  - 將 Dashboard 改為 Client Component
- **狀態**：待確認
- **注意事項**：會影響 SSR 效能，需評估影響

### 6. 智慧更新機制
- **描述**：根據市場開盤狀態自動調整更新頻率
- **更新策略**：
  - 台股/美股開市中：每 5 分鐘更新
  - 收盤後：每 30 分鐘更新
  - 週末：暫停自動更新
- **技術方案**：
  - 改用 Client Component + setInterval
  - 根據 `getMarketStatus()` 動態調整頻率
- **狀態**：待評估
- **優缺點**：
  - ✅ 更即時的資料
  - ❌ 無法利用 Next.js SSR 快取
  - ❌ 增加 API 請求次數
- **建議**：可與前端快取優化（#2）結合實作

## 🔧 中優先度

### ~~7. 更多歷史資料範圍~~
- **完成日期**：2025-12-30
- **完成方式**：在另一台電腦上實作完成
- **描述**：支援更長時間的歷史資料查詢
- **已實作內容**：
  - ✅ 1 個月、3 個月、6 個月、1 年時間範圍
  - ✅ 在圖表頁面實作時間範圍選擇器
  - ✅ 使用 Yahoo Finance API 獲取歷史資料
- **待擴充**：可再增加 2 年、5 年、全部時間（自 2024-05-30）選項

### 8. 資料匯出功能
- **描述**：允許使用者匯出持股資料
- **支援格式**：CSV, Excel, PDF
- **狀態**：待開發

### 9. 價格警示通知
- **描述**：當股價達到設定值時發送通知
- **技術需求**：
  - Web Push API 或 Email 通知
  - 需要後端服務定期檢查價格
- **狀態**：待評估

## 💡 低優先度

### 10. 多投資組合支援
- **描述**：允許使用者建立並切換多個投資組合
- **儲存方式**：localStorage 或 Database
- **狀態**：待評估

### 11. 深色模式
- **描述**：支援深色主題
- **技術方案**：使用 next-themes
- **狀態**：待開發

### 12. 行動 App (PWA)
- **描述**：支援 Progressive Web App
- **功能**：
  - 可安裝到手機桌面
  - 離線快取
  - 推播通知
- **狀態**：待評估

### 13. 效能分析圖表
- **描述**：顯示投資組合效能指標
- **指標內容**：
  - 年化報酬率
  - 夏普比率
  - 最大回撤
  - 與大盤比較
- **狀態**：待開發

## 📊 數據相關

### 14. 更多資料來源
- **描述**：整合更多股票市場資料
- **可能新增**：
  - 港股
  - 日股
  - 以太幣等其他加密貨幣
  - 更多台股標的
  - 國際 ETF
- **狀態**：待評估

### 15. 大盤比較功能
- **描述**：將投資組合表現與大盤指數比較
- **可能指標**：
  - 台灣加權指數 (TAIEX)
  - S&P 500
  - NASDAQ
- **顯示方式**：
  - 在投資組合圖表上疊加大盤走勢
  - 顯示相對表現（跑贏/跑輸大盤）
  - 計算 Beta 值和相關性
- **狀態**：待開發

### 16. 股息追蹤
- **描述**：記錄並顯示股息收入
- **功能**：
  - 手動輸入股息記錄
  - 計算總股息收益
  - 股息再投資模擬
- **狀態**：待開發

## 🎨 UI/UX 改進

### 17. UI 設計細節優化
- **描述**：優化整體視覺設計和使用者體驗
- **可能改進項目**：
  - 卡片陰影和間距調整
  - 按鈕 hover 效果優化
  - 顏色對比度提升
  - 字體大小和行距調整
  - 表格行高和間距優化
- **狀態**：待優化

### 18. 響應式圖表優化
- **描述**：改善行動裝置上的圖表顯示
- **狀態**：待優化

### 19. 動畫效果
- **描述**：加入流暢的過場動畫
- **使用套件**：Framer Motion
- **狀態**：待評估

### 20. 歷史數據密集度優化
- **描述**：優化圖表資料點的顯示密集程度
- **可能方案**：
  - 根據時間範圍自動調整資料採樣間隔
  - 1 個月：每日資料點
  - 3 個月：每 2-3 天一個資料點
  - 1 年：每週資料點
  - 或使用圖表庫的自動稀疏化功能
- **狀態**：待評估

---

## 📝 備註

- 此文件會持續更新
- 每個功能在開發前都應評估必要性和優先級
- 優先考慮 MVP (Minimum Viable Product) 原則
- 保持程式碼簡潔，避免過度工程化
- **完成的項目不刪除**：使用刪除線標記，並註明完成日期與方式

最後更新：2025-12-31
